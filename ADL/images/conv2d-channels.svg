<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 820 520" font-family="'Segoe UI', Arial, sans-serif">
  <defs>
    <style>
      .title { font-size: 16px; font-weight: 700; fill: #1e293b; }
      .label { font-size: 13px; font-weight: 600; fill: #475569; }
      .sub-label { font-size: 11px; fill: #64748b; }
      .cell-text { font-size: 10px; fill: #334155; font-weight: 500; }
      .formula { font-size: 13px; fill: #6366f1; font-weight: 600; }
      .formula-sm { font-size: 11px; fill: #6366f1; font-weight: 600; }
      .dim-text { font-size: 11px; fill: #94a3b8; font-weight: 500; }
      .accent { font-size: 12px; fill: #059669; font-weight: 600; }
    </style>
    <linearGradient id="ch1" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#dbeafe"/>
      <stop offset="100%" stop-color="#bfdbfe"/>
    </linearGradient>
    <linearGradient id="ch2" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#e0e7ff"/>
      <stop offset="100%" stop-color="#c7d2fe"/>
    </linearGradient>
    <linearGradient id="ch3" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#ede9fe"/>
      <stop offset="100%" stop-color="#ddd6fe"/>
    </linearGradient>
    <linearGradient id="kGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fef3c7"/>
      <stop offset="100%" stop-color="#fde68a"/>
    </linearGradient>
    <linearGradient id="outGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#d1fae5"/>
      <stop offset="100%" stop-color="#a7f3d0"/>
    </linearGradient>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#64748b"/>
    </marker>
    <marker id="arrowGreen" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#059669"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="410" y="28" text-anchor="middle" class="title">Multi-Channel Conv2D &amp; Parameter Counting</text>

  <!-- ====== INPUT CHANNELS (stacked) ====== -->
  <text x="95" y="58" text-anchor="middle" class="label">Input Feature Map</text>
  <text x="95" y="74" text-anchor="middle" class="dim-text">H × W × C_in</text>

  <!-- Channel 3 (back, offset) -->
  <g transform="translate(30, 95)" opacity="0.7">
    <rect x="16" y="-16" width="100" height="100" rx="5" fill="url(#ch3)" stroke="#8b5cf6" stroke-width="1.2"/>
    <text x="66" y="42" text-anchor="middle" class="sub-label" fill="#7c3aed">Ch 3</text>
  </g>

  <!-- Channel 2 (middle, offset) -->
  <g transform="translate(30, 95)" opacity="0.85">
    <rect x="8" y="-8" width="100" height="100" rx="5" fill="url(#ch2)" stroke="#6366f1" stroke-width="1.2"/>
    <text x="58" y="50" text-anchor="middle" class="sub-label" fill="#4f46e5">Ch 2</text>
  </g>

  <!-- Channel 1 (front) -->
  <g transform="translate(30, 95)">
    <rect x="0" y="0" width="100" height="100" rx="5" fill="url(#ch1)" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="50" y="55" text-anchor="middle" class="sub-label" fill="#2563eb">Ch 1</text>
  </g>

  <!-- C_in bracket -->
  <text x="160" y="142" text-anchor="start" class="dim-text">} C_in channels</text>

  <!-- ====== Convolution symbol ====== -->
  <text x="240" y="165" text-anchor="middle" font-size="22" fill="#6366f1" font-weight="700">⊗</text>

  <!-- ====== KERNEL SET (for 1 output filter) ====== -->
  <text x="360" y="58" text-anchor="middle" class="label">Filter 1 of C_out</text>
  <text x="360" y="74" text-anchor="middle" class="dim-text">K_h × K_w × C_in</text>

  <!-- Kernel slice 3 (back) -->
  <g transform="translate(305, 95)" opacity="0.7">
    <rect x="16" y="-16" width="80" height="80" rx="4" fill="url(#kGrad)" stroke="#d97706" stroke-width="1.2"/>
    <text x="56" y="32" text-anchor="middle" class="cell-text" fill="#92400e">K_3</text>
  </g>

  <!-- Kernel slice 2 -->
  <g transform="translate(305, 95)" opacity="0.85">
    <rect x="8" y="-8" width="80" height="80" rx="4" fill="url(#kGrad)" stroke="#f59e0b" stroke-width="1.2"/>
    <text x="48" y="40" text-anchor="middle" class="cell-text" fill="#92400e">K_2</text>
  </g>

  <!-- Kernel slice 1 (front) -->
  <g transform="translate(305, 95)">
    <rect x="0" y="0" width="80" height="80" rx="4" fill="url(#kGrad)" stroke="#f59e0b" stroke-width="1.5"/>
    <text x="40" y="45" text-anchor="middle" class="cell-text" fill="#92400e">K_1</text>
  </g>

  <!-- + bias -->
  <text x="410" y="185" text-anchor="middle" class="sub-label">+ bias</text>

  <!-- ====== EQUALS ====== -->
  <text x="450" y="150" text-anchor="middle" font-size="20" fill="#64748b" font-weight="700">=</text>

  <!-- ====== SINGLE OUTPUT CHANNEL ====== -->
  <g transform="translate(480, 95)">
    <rect x="0" y="0" width="90" height="90" rx="5" fill="url(#outGrad)" stroke="#059669" stroke-width="1.5"/>
    <text x="45" y="50" text-anchor="middle" class="accent">Out Ch 1</text>
  </g>

  <!-- ====== Multiple output filters ====== -->
  <text x="680" y="58" text-anchor="middle" class="label">Output Feature Map</text>
  <text x="680" y="74" text-anchor="middle" class="dim-text">H' × W' × C_out</text>

  <!-- Dashed arrow to full output -->
  <line x1="580" y1="140" x2="620" y2="140" stroke="#64748b" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrow)"/>

  <!-- Stacked output channels -->
  <g transform="translate(630, 90)" opacity="0.6">
    <rect x="20" y="-20" width="90" height="90" rx="5" fill="url(#outGrad)" stroke="#059669" stroke-width="1"/>
    <text x="65" y="30" text-anchor="middle" class="sub-label" fill="#059669">Out C_out</text>
  </g>
  <g transform="translate(630, 90)" opacity="0.75">
    <rect x="13" y="-13" width="90" height="90" rx="5" fill="url(#outGrad)" stroke="#059669" stroke-width="1"/>
  </g>
  <g transform="translate(630, 90)" opacity="0.88">
    <rect x="6" y="-6" width="90" height="90" rx="5" fill="url(#outGrad)" stroke="#059669" stroke-width="1"/>
  </g>
  <g transform="translate(630, 90)">
    <rect x="0" y="0" width="90" height="90" rx="5" fill="url(#outGrad)" stroke="#059669" stroke-width="1.5"/>
    <text x="45" y="50" text-anchor="middle" class="accent">Out 1</text>
  </g>
  <text x="775" y="138" text-anchor="start" class="dim-text">} C_out</text>

  <!-- ====== PARAMETER COUNTING BOX ====== -->
  <rect x="40" y="260" width="740" height="110" rx="10" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1.5"/>

  <text x="410" y="288" text-anchor="middle" class="label" font-size="14">Parameter Count Formula</text>

  <text x="410" y="316" text-anchor="middle" class="formula">
    Params = (K_h × K_w × C_in + 1) × C_out
  </text>
  <text x="410" y="340" text-anchor="middle" class="dim-text">
    each filter has K_h × K_w × C_in weights + 1 bias, repeated for C_out filters
  </text>

  <!-- ====== CONCRETE EXAMPLE BOX ====== -->
  <rect x="40" y="390" width="740" height="105" rx="10" fill="#f0fdf4" stroke="#bbf7d0" stroke-width="1.5"/>

  <text x="410" y="418" text-anchor="middle" class="accent" font-size="14">Example: 3×3 Conv, 64 → 128 channels</text>

  <text x="410" y="446" text-anchor="middle" class="formula-sm">
    Params = (3 × 3 × 64 + 1) × 128 = (576 + 1) × 128 = 577 × 128 = 73,856
  </text>
  <text x="410" y="472" text-anchor="middle" class="dim-text">
    K_h=3, K_w=3, C_in=64, C_out=128  →  73,856 trainable parameters
  </text>
</svg>
